<script lang="ts">
	import MemoryGame from '$lib/components/MemoryGame.svelte';
	import { fade, fly } from 'svelte/transition';
	import { onMount } from 'svelte';

	let visible = false;
	let mouseX = 0;
	let mouseY = 0;

	function handleMouseMove(event: MouseEvent) {
		mouseX = event.clientX / window.innerWidth;
		mouseY = event.clientY / window.innerHeight;
	}

	onMount(() => {
		visible = true;
		window.addEventListener('mousemove', handleMouseMove);

		return () => {
			window.removeEventListener('mousemove', handleMouseMove);
		};
	});
</script>

<svelte:head>
	<title>Memory Game | Maarten Van Doninck</title>
	<meta name="description" content="Play an interactive memory matching game" />
</svelte:head>

<div class="game-background" style="--mouse-x: {mouseX}; --mouse-y: {mouseY}">
	<div class="memory-bg-piece piece1"></div>
	<div class="memory-bg-piece piece2"></div>
	<div class="memory-bg-piece piece3"></div>
	<div class="memory-bg-piece piece4"></div>
	<div class="memory-bg-piece piece5"></div>
	<div class="memory-bg-piece piece6"></div>

	{#if visible}
		<div class="container relative z-10 mx-auto my-5" in:fade={{ duration: 800 }}>
			<header class="mb-8 text-center" in:fly={{ y: -20, duration: 800 }}>
				<h1 class="text-gradient text-4xl font-bold">Memory Game</h1>
				<p class="mt-3 text-gray-600">Find matching pairs to complete the challenge</p>
			</header>

			<div class="game-card" in:fly={{ y: 20, duration: 800, delay: 300 }}>
				<div class="card-body">
					<div class="game-instructions mb-6">
						<h2 class="mb-2 text-xl font-bold">How to play:</h2>
						<ol class="ml-6 list-decimal">
							<li>Click on a card to flip it</li>
							<li>Find matching pairs of cards</li>
							<li>Match all pairs to complete the game</li>
						</ol>
					</div>

					<div class="game-container">
						<MemoryGame />
					</div>

					<div class="mt-8 text-center">
						<a href="/" class="back-button" in:fade={{ delay: 800, duration: 300 }}>
							‚Üê Back to Home
						</a>
					</div>
				</div>
			</div>
		</div>
	{/if}
</div>

<style>
	.game-background {
		position: relative;
		min-height: 100vh;
		padding: 2rem 0;
		overflow: hidden;
		background: linear-gradient(-45deg, #f3f4f6, #e5e7eb, #ede9fe, #dbeafe);
		background-size: 400% 400%;
		animation: gradient 15s ease infinite;
	}

	@keyframes gradient {
		0% {
			background-position: 0% 50%;
		}
		50% {
			background-position: 100% 50%;
		}
		100% {
			background-position: 0% 50%;
		}
	}

	.memory-bg-piece {
		position: absolute;
		opacity: 0.1;
		background-image: url("data:image/svg+xml,%3Csvg width='100' height='100' viewBox='0 0 100 100' xmlns='http://www.w3.org/2000/svg'%3E%3Crect width='80' height='80' x='10' y='10' rx='15' fill='%233b82f6'/%3E%3C/svg%3E");
		background-repeat: no-repeat;
		background-size: contain;
		will-change: transform;
		transition: transform 0.3s ease-out;
	}

	.piece1 {
		top: 10%;
		left: 5%;
		width: 80px;
		height: 80px;
		animation: float 8s ease-in-out infinite;
		transform: translate(calc(var(--mouse-x, 0.5) * -30px), calc(var(--mouse-y, 0.5) * -30px))
			rotate(15deg);
	}

	.piece2 {
		top: 20%;
		right: 10%;
		width: 120px;
		height: 120px;
		animation: float 12s ease-in-out infinite reverse;
		transform: translate(calc(var(--mouse-x, 0.5) * 20px), calc(var(--mouse-y, 0.5) * -25px))
			rotate(-10deg);
	}

	.piece3 {
		bottom: 15%;
		right: 5%;
		width: 100px;
		height: 100px;
		animation: float 10s ease-in-out infinite 2s;
		transform: translate(calc(var(--mouse-x, 0.5) * 25px), calc(var(--mouse-y, 0.5) * 20px))
			rotate(45deg);
	}

	.piece4 {
		bottom: 10%;
		left: 10%;
		width: 90px;
		height: 90px;
		animation: float 11s ease-in-out infinite 1s;
		transform: translate(calc(var(--mouse-x, 0.5) * -20px), calc(var(--mouse-y, 0.5) * 30px))
			rotate(-25deg);
	}

	.piece5 {
		top: 40%;
		left: 20%;
		width: 70px;
		height: 70px;
		animation: float 9s ease-in-out infinite 1.5s;
		transform: translate(calc(var(--mouse-x, 0.5) * -15px), calc(var(--mouse-y, 0.5) * 15px))
			rotate(60deg);
	}

	.piece6 {
		top: 60%;
		right: 15%;
		width: 110px;
		height: 110px;
		animation: float 14s ease-in-out infinite 1s;
		transform: translate(calc(var(--mouse-x, 0.5) * 15px), calc(var(--mouse-y, 0.5) * -15px))
			rotate(-55deg);
	}

	@keyframes float {
		0% {
			transform: translate(calc(var(--mouse-x, 0.5) * -20px), calc(var(--mouse-y, 0.5) * -20px))
				rotate(0deg);
		}
		50% {
			transform: translate(calc(var(--mouse-x, 0.5) * 20px), calc(var(--mouse-y, 0.5) * 20px))
				rotate(10deg);
		}
		100% {
			transform: translate(calc(var(--mouse-x, 0.5) * -20px), calc(var(--mouse-y, 0.5) * -20px))
				rotate(0deg);
		}
	}

	.text-gradient {
		background: linear-gradient(45deg, #3b82f6, #9333ea);
		-webkit-background-clip: text;
		-webkit-text-fill-color: transparent;
	}
</style>
